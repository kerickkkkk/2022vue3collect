import{s as M,j as z,k as I,l as R,i as H,r as g,m as J,a as u,o as m,c as _,b as e,p as n,F as K,n as Q,d as k,e as d,f as C,x as i,g as W,w as $,v as U,y as p}from"./index-907ac9d8.js";function X(y){return M({method:"POST",url:"/order",data:y})}const Y={class:"container"},Z=e("h3",null,"購物車區塊",-1),ee={class:"row"},te={class:"row"},se={class:"text-end"},le={class:"table"},oe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"商品選項"),e("th",{scope:"col"},"單價"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"},"刪除")])],-1),ae={class:"cart__title d-flex"},ne={class:"me-3"},de=["src","alt"],ie={class:"cart__title__content"},ce={class:"h6"},re=e("p",null,"規格",-1),ue={class:"text-end"},me={class:"btn-group",role:"group","aria-label":"Basic checkbox toggle button group"},_e=["onClick"],pe=["onChange","onUpdate:modelValue"],he=["disabled","onClick"],ve={class:"text-end"},be=["onClick"],fe={key:1},ge={colspan:"100",class:"text-center"},ye={class:"text-end",colspan:"100"},Ve={class:"text-end",colspan:"100"},xe=e("h3",null,"驗證區塊",-1),ke={class:"mb-3"},Ce=e("label",{for:"name",class:"form-label"},"姓名",-1),$e={class:"mb-3"},Ue=e("label",{for:"email",class:"form-label"},"Email",-1),qe={class:"mb-3"},we=e("label",{for:"tel",class:"form-label"},"電話",-1),Te={class:"mb-3"},Se=e("label",{for:"address",class:"form-label"},"地址",-1),Ne={class:"mb-3"},Fe=e("label",{for:"message",class:"form-label"},"留言",-1),Be=e("button",{class:"btn btn-primary",type:"submit"},"送出訂單",-1),Le={__name:"CartView",setup(y){const q=z(),V=I(),{setLoading:h}=q,{getCarts:w,updateCart:v,deleteCart:T,deleteAllCarts:x}=V,{cartsGetter:b,totalGetter:S,finalTotalGetter:N}=R(V),f=H("$swal"),F="https://vue3-course-api.hexschool.io/v2",B="vue3",D={name:"",email:"",tel:"",address:"",message:""},L=g([]),E=g(null),l=g({name:"",email:"",tel:"",address:"",message:""}),G=()=>{l.value={...D.value}},O=()=>{h(!0),W.get(`${F}/api/${B}/products?page=1`).then(({data:a})=>{h(!1),L.value=a.products,E.value=a.pagination}).catch(a=>{var s;h(!1),console.dir(a),f((s=a==null?void 0:a.response)==null?void 0:s.data)})},P=()=>{if(b.value.length<=0)return f("購物車沒產品"),!1;const a={data:{user:{name:l.value.name,tel:l.value.tel,email:l.value.email,address:l.value.address},message:l.value.message}};X(a).then(s=>{f(`${s.message}，訂單編號：${s.orderId}，總價: ${s.total} 元。`),w(),G()}).then(s=>{console.log(s)})};return J(()=>{O()}),(a,s)=>{const j=u("routerLink"),c=u("VField"),r=u("error-message"),A=u("VForm");return m(),_("div",Y,[Z,e("div",ee,[e("div",te,[e("div",se,[e("button",{onClick:s[0]||(s[0]=(...t)=>n(x)&&n(x)(...t)),class:"btn btn-sm btn-outline-danger"}," 清空購物車 ")]),e("table",le,[oe,e("tbody",null,[n(b).length>0?(m(!0),_(K,{key:0},Q(n(b),t=>(m(),_("tr",{key:t.id},[e("th",null,[e("div",ae,[e("div",ne,[e("img",{src:t.product.imageUrl,alt:t.product.title,width:"50",class:"img-fluid"},null,8,de)]),e("div",ie,[e("div",ce,i(t.product.title),1),re])])]),e("td",ue,"NT $"+i(t.product.price),1),e("td",null,[e("div",me,[e("button",{onClick:o=>n(v)(t.id,t.product.id,++t.qty),type:"button",class:"btn btn-primary"}," + ",8,_e),$(e("input",{onChange:o=>n(v)(t.id,t.product.id,t.qty),"onUpdate:modelValue":o=>t.qty=o,type:"number",min:"1",class:"form-control rounded-0",style:{width:"80px"}},null,40,pe),[[U,t.qty]]),e("button",{disabled:t.qty<2,onClick:o=>n(v)(t.id,t.product.id,--t.qty),type:"button",class:"btn btn-primary"}," - ",8,he)])]),e("td",ve,"NT $"+i(t.final_total),1),e("td",null,[e("button",{onClick:o=>n(T)(t.id),class:"btn btn-sm btn-outline-danger"}," 刪除 ",8,be)])]))),128)):(m(),_("tr",fe,[e("td",ge,[k(" 購物車沒有東西 "),d(j,{to:"/products"},{default:C(()=>[k(" 挑選產品去")]),_:1})])]))]),e("tfoot",null,[e("tr",null,[e("td",ye,"原價 NT $ "+i(n(S)),1)]),e("tr",null,[e("td",Ve,"總價 NT $ "+i(n(N)),1)])])])])]),xe,d(A,{onSubmit:P},{default:C(({errors:t})=>[e("div",ke,[Ce,d(c,{modelValue:l.value.name,"onUpdate:modelValue":s[1]||(s[1]=o=>l.value.name=o),id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入 姓名",rules:"required"},null,8,["modelValue","class"]),d(r,{name:"姓名",class:"invalid-feedback"})]),e("div",$e,[Ue,d(c,{modelValue:l.value.email,"onUpdate:modelValue":s[2]||(s[2]=o=>l.value.email=o),id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["modelValue","class"]),d(r,{name:"email",class:"invalid-feedback"})]),e("div",qe,[we,d(c,{modelValue:l.value.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>l.value.tel=o),id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入 電話",rules:"required|min:8|max:10"},null,8,["modelValue","class"]),d(r,{name:"電話",class:"invalid-feedback"})]),e("div",Te,[Se,d(c,{modelValue:l.value.address,"onUpdate:modelValue":s[4]||(s[4]=o=>l.value.address=o),id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入 地址",rules:"required"},null,8,["modelValue","class"]),d(r,{modelValue:l.value.address,"onUpdate:modelValue":s[5]||(s[5]=o=>l.value.address=o),name:"地址",class:"invalid-feedback"},null,8,["modelValue"])]),e("div",Ne,[Fe,$(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=o=>l.value.message=o),class:"form-control",id:"message",placeholder:"請輸入 留言","aria-describedby":"message"},null,512),[[U,l.value.message]])]),Be]),_:1})])}}};export{Le as default};
